import sys
import pandas as pd
import pathlib
import html
import json
import logging
import requests
import urllib
import time
from bs4 import BeautifulSoup
def gen_url(keywords="", categoryId="", locationStr="", locationId="", radius="", sortingField="SORTING_DATE", adType="", posterType="", pageNum="1", action="find", maxPrice="", minPrice=""):
    return "https://www.ebay-kleinanzeigen.de/s-suchanfrage.html?&keywords={}&categoryId={}&locationStr={}&locationId={}&radius={}&sortingField={}&adType={}&posterType={}&pageNum={}&action={}&maxPrice={}&minPrice={}".format(urllib.parse.quote(keywords), urllib.parse.quote(categoryId), urllib.parse.quote(locationStr), urllib.parse.quote(locationId), urllib.parse.quote(radius), urllib.parse.quote(sortingField), urllib.parse.quote(adType), urllib.parse.quote(posterType), urllib.parse.quote(pageNum), urllib.parse.quote(action), urllib.parse.quote(maxPrice), urllib.parse.quote(minPrice))
# load the url
intel_processors=[("i7 5960X",4,), ("i7 5930K",4,), ("i7 5820K",4,), ("i7 4790K",4,), ("i7 4790",4,), ("i7 4790S",4,), ("i7 4790T",4,), ("i7 4785T",4,), ("i7 4771",4,), ("i7 4770K",4,), ("i7 4770",4,), ("i7 4770S",4,), ("i7 4770R",4,), ("i7 4770T",4,), ("i7 4770TE",4,), ("i7 4765T",4,), ("i5 4690K",4,), ("i5 4690",4,), ("i5 4690S",4,), ("i5 4690T",4,), ("i5 4670K",4,), ("i5 4670",4,), ("i5 4670S",4,), ("i5 4670R",4,), ("i5 4670T",4,), ("i5 4590",4,), ("i5 4590S",4,), ("i5 4590T",4,), ("i5 4570",4,), ("i5 4570S",4,), ("i5 4570R",4,), ("i5 4570T",4,), ("i5 4570TE",4,), ("i5 4460",4,), ("i5 4460S",4,), ("i5 4460T",4,), ("i5 4440",4,), ("i5 4440S",4,), ("i5 4430",4,), ("i5 4430S",4,), ("i3 4370",4,), ("i3 4360",4,), ("i3 4350",4,), ("i3 4340",4,), ("i3 4330",4,), ("i3 4370T",4,), ("i3 4360T",4,), ("i3 4350T",4,), ("i3 4330T",4,), ("i3 4340TE",4,), ("i3 4330TE",4,), ("i3 4170",4,), ("i3 4160",4,), ("i3 4150",4,), ("i3 4130",4,), ("i3 4170T",4,), ("i3 4160T",4,), ("i3 4150T",4,), ("i3 4130T",4,), ("pentium G3470",4,), ("pentium G3460",4,), ("pentium G3450",4,), ("pentium G3440",4,), ("pentium G3430",4,), ("pentium G3420",4,), ("pentium G3460T",4,), ("pentium G3450T",4,), ("pentium G3440T",4,), ("pentium G3420T",4,), ("pentium G3320TE",4,), ("pentium G3260",4,), ("pentium G3258",4,), ("pentium G3250",4,), ("pentium G3240",4,), ("pentium G3220",4,), ("pentium G3260T",4,), ("pentium G3250T",4,), ("pentium G3240T",4,), ("pentium G3220T",4,), ("celeron G1850",4,), ("celeron G1840",4,), ("celeron G1830",4,), ("celeron G1820",4,), ("celeron G1840T",4,), ("celeron G1820T",4,), ("celeron G1820TE",4,), ("xeon E7-8893v3",4,), ("xeon E7-8891v3",4,), ("xeon E7-8890v3",4,), ("xeon E7-8880v3",4,), ("xeon E7-8880Lv3",4,), ("xeon E7-8870v3",4,), ("xeon E7-8867v3",4,), ("xeon E7-8860v3",4,), ("xeon E7-4850v3",4,), ("xeon E7-4830v3",4,), ("xeon E7-4820v3",4,), ("xeon E7-4809v3",4,), ("xeon 2699v3",4,), ("xeon 2698v3",4,), ("xeon 2698Av3",4,), ("xeon 2697v3",4,), ("xeon 2695v3",4,), ("xeon 2690v3",4,), ("xeon 2683v3",4,), ("xeon 2680v3",4,), ("xeon 2673v3",4,), ("xeon 2670v3",4,), ("xeon 2667v3",4,), ("xeon 2660v3",4,), ("xeon 2650Lv3",4,), ("xeon 2658v3",4,), ("xeon 2650v3",4,), ("xeon 2648Lv3",4,), ("xeon 2643v3",4,), ("xeon 2640v3",4,), ("xeon 2637v3",4,), ("xeon 2630v3",4,), ("xeon 2630Lv3",4,), ("xeon 2628Lv3",4,), ("xeon 2623v3",4,), ("xeon 2620v3",4,), ("xeon 2618Lv3",4,), ("xeon 2609v3",4,), ("xeon 2608Lv3",4,), ("xeon 2603v3",4,), ("xeon 2687Wv3",4,), ("xeon 1680v3",4,), ("xeon 1660v3",4,), ("xeon 1650v3",4,), ("xeon 1630v3",4,), ("xeon 1620v3",4,), ("xeon 1607v3",4,), ("xeon 1603v3",4,), ("xeon 1286v3",4,), ("xeon 1286Lv3",4,), ("xeon 1285v3",4,), ("xeon 1285Lv3",4,), ("xeon 1284Lv3",4,), ("xeon 1281v3",4,), ("xeon 1280v3",4,), ("xeon 1276v3",4,), ("xeon 1275v3",4,), ("xeon 1275Lv3",4,), ("xeon 1271v3",4,), ("xeon 1270v3",4,), ("xeon 1268Lv3",4,), ("xeon 1265Lv3",4,), ("xeon 1246v3",4,), ("xeon 1245v3",4,), ("xeon 1241v3",4,), ("xeon 1240v3",4,), ("xeon 1240Lv3",4,), ("xeon 1231v3",4,), ("xeon 1230v3",4,), ("xeon 1230Lv3",4,), ("xeon 1226v3",4,), ("xeon 1225v3",4,), ("xeon 1220v3",4,), ("xeon 1220Lv3",4,), ("i7 4940MX",4,), ("i7 4930MX",4,), ("i7 4980HQ",4,), ("i7 4960HQ",4,), ("i7 4950HQ",4,), ("i7 4910MQ",4,), ("i7 4900MQ",4,), ("i7 4870HQ",4,), ("i7 4860EQ",4,), ("i7 4860HQ",4,), ("i7 4850EQ",4,), ("i7 4850HQ",4,), ("i7 4810MQ",4,), ("i7 4800MQ",4,), ("i7 4770HQ",4,), ("i7 4760HQ",4,), ("i7 4750HQ",4,), ("i7 4720HQ",4,), ("i7 4712MQ",4,), ("i7 4712HQ",4,), ("i7 4710MQ",4,), ("i7 4710HQ",4,), ("i7 4702MQ",4,), ("i7 4702HQ",4,), ("i7 4700MQ",4,), ("i7 4700HQ",4,), ("i7 4701EQ",4,), ("i7 4700EQ",4,), ("i7 4702EC",4,), ("i7 4700EC",4,), ("i7 4650U",4,), ("i7 4610Y",4,), ("i7 4610M",4,), ("i7 4600M",4,), ("i7 4600U",4,), ("i7 4578U",4,), ("i7 4558U",4,), ("i7 4550U",4,), ("i7 4510U",4,), ("i7 4500U",4,), ("i5 4402EC",4,), ("i5 4422E",4,), ("i5 4410E",4,), ("i5 4402E",4,), ("i5 4400E",4,), ("i5 4360U",4,), ("i5 4350U",4,), ("i5 4340M",4,), ("i5 4330M",4,), ("i5 4310M",4,), ("i5 4310U",4,), ("i5 4302Y",4,), ("i5 4300Y",4,), ("i5 4300M",4,), ("i5 4300U",4,), ("i5 4288U",4,), ("i5 4258U",4,), ("i5 4308U",4,), ("i5 4260U",4,), ("i5 4250U",4,), ("i5 4210H",4,), ("i5 4210M",4,), ("i5 4210U",4,), ("i5 4220Y",4,), ("i5 4210Y",4,), ("i5 4202Y",4,), ("i5 4200Y",4,), ("i5 4200U",4,), ("i5 4200H",4,), ("i5 4200M",4,), ("i3 4158U",4,), ("i3 4120U",4,), ("i3 4112E",4,), ("i3 4110E",4,), ("i3 4102E",4,), ("i3 4100E",4,), ("i3 4110M",4,), ("i3 4100M",4,), ("i3 4100U",4,), ("i3 4030Y",4,), ("i3 4020Y",4,), ("i3 4012Y",4,), ("i3 4010Y",4,), ("i3 4030U",4,), ("i3 4025U",4,), ("i3 4010U",4,), ("i3 4005U",4,), ("i3 4000M",4,), ("pentium 3561Y",4,), ("pentium 3560Y",4,), ("pentium 3558U",4,), ("pentium 3556U",4,), ("pentium 3560M",4,), ("pentium 3550M",4,), ("celeron 2981U",4,), ("celeron 2980U",4,), ("celeron 2957U",4,), ("celeron 2955U",4,), ("celeron 2970M",4,), ("celeron 2950M",4,), ("celeron 2961Y",4,), ("i7 5775C",5,), ("i5 5675C",5,), ("i7 6950X",5,), ("i7 6900K",5,), ("i7 6850K",5,), ("i7 6800K",5,), ("i7 5775R",5,), ("i5 5675R",5,), ("i5 5575R",5,), ("xeon 1284Lv4",5,), ("xeon 1278Lv4",5,), ("xeon 1258Lv4",5,), ("i7 5950HQ",5,), ("i7 5850HQ",5,), ("i7 5750HQ",5,), ("i7 5700HQ",5,), ("i7 5650U",5,), ("i7 5600U",5,), ("i7 5557U",5,), ("i7 5550U",5,), ("i7 5500U",5,), ("i5 5350H",5,), ("i5 5350U",5,), ("i5 5300U",5,), ("i5 5287U",5,), ("i5 5257U",5,), ("i5 5250U",5,), ("i5 5200U",5,), ("i3 5157U",5,), ("i3 5020U",5,), ("i3 5015U",5,), ("i3 5010U",5,), ("i3 5005U",5,), ("pentium 3825U",5,), ("pentium 3805U",5,), ("celeron 3755U",5,), ("celeron 3205U",5,), ("intel 5Y71",5,), ("intel 5Y70",5,), ("intel 5Y51",5,), ("intel 5Y31",5,), ("intel 5Y10c",5,), ("intel 5Y10a",5,), ("intel 5Y10",5,), ("xeon D-1587",5,), ("xeon D-1577",5,), ("xeon D-1571",5,), ("xeon D-1567",5,), ("xeon D-1559",5,), ("xeon D-1557",5,), ("xeon D-1553N",5,), ("xeon D-1548",5,), ("xeon D-1543N",5,), ("xeon D-1541",5,), ("xeon D-1540",5,), ("xeon D-1539",5,), ("xeon D-1537",5,), ("xeon D-1533N",5,), ("xeon D-1531",5,), ("xeon D-1529",5,), ("xeon D-1528",5,), ("xeon D-1527",5,), ("xeon D-1523N",5,), ("xeon D-1521",5,), ("xeon D-1520",5,), ("xeon D-1518",5,), ("xeon D-1513N",5,), ("pentium D1519",5,), ("pentium D1517",5,), ("pentium D1509",5,), ("pentium D1508",5,), ("pentium D1507",5,), ("xeon 1285v4",5,), ("xeon 1285Lv4",5,), ("xeon 1265Lv4",5,), ("xeon 2699v4",5,), ("xeon 2698v4",5,), ("xeon 2697v4",5,), ("xeon 2697Av4",5,), ("xeon 2695v4",5,), ("xeon 2690v4",5,), ("xeon 2689v4",5,), ("xeon 2687Wv4",5,), ("xeon 2683v4",5,), ("xeon 2680v4",5,), ("xeon 2667v4",5,), ("xeon 2660v4",5,), ("xeon 2658v4",5,), ("xeon 2650v4",5,), ("xeon 2650Lv4",5,), ("xeon 2648Lv4",5,), ("xeon 2643v4",5,), ("xeon 2640v4",5,), ("xeon 2637v4",5,), ("xeon 2630v4",5,), ("xeon 2630Lv4",5,), ("xeon 2628Lv4",5,), ("xeon 2623v4",5,), ("xeon 2620v4",5,), ("xeon 2618Lv4",5,), ("xeon 2609v4",5,), ("xeon 2608Lv4",5,), ("xeon 2603v4",5,), ("xeon 1680v4",5,), ("xeon 1660v4",5,), ("xeon 1650v4",5,), ("xeon 1630v4",5,), ("xeon 1620v4",5,), ("i7 6700K",7,), ("i7 6785R",7,), ("i7 6700",7,), ("i7 6700T",7,), ("i5 6600K",7,), ("i5 6685R",7,), ("i5 6600",7,), ("i5 6585R",7,), ("i5 6500",7,), ("i5 6600T",7,), ("i5 6500T",7,), ("i5 6402P",7,), ("i5 6400T",7,), ("i5 6400",7,), ("i3 6320",7,), ("i3 6300",7,), ("i3 6100",7,), ("i3 6300T",7,), ("i3 6100T",7,), ("i3 6098P",7,), ("pentium G4520",7,), ("pentium G4500",7,), ("pentium G4500T",7,), ("pentium G4400",7,), ("pentium G4400T",7,), ("pentium G4400TE",7,), ("celeron G3920",7,), ("celeron G3900",7,), ("celeron G3900TE",7,), ("celeron G3900T",7,), ("i9 7980XE",7,), ("i9 7960X",7,), ("i9 7940X",7,), ("i9 7920X",7,), ("i9 7900X",7,), ("i7 7820X",7,), ("i7 7800X",7,), ("i9 9980XE",7,), ("i9 9960X",7,), ("i9 9940X",7,), ("i9 9920X",7,), ("i9 9900X",7,), ("i9 9820X",7,), ("i7 9800X",7,), ("i7 6970HQ",7,), ("i7 6920HQ",7,), ("i7 6870HQ",7,), ("i7 6820HQ",7,), ("i7 6820HK",7,), ("i7 6770HQ",7,), ("i7 6700HQ",7,), ("i7 6660U",7,), ("i7 6650U",7,), ("i7 6600U",7,), ("i7 6567U",7,), ("i7 6560U",7,), ("i7 6500U",7,), ("i5 6440HQ",7,), ("i5 6360U",7,), ("i5 6350HQ",7,), ("i5 6300HQ",7,), ("i5 6300U",7,), ("i5 6287U",7,), ("i5 6267U",7,), ("i5 6260U",7,), ("i5 6200U",7,), ("i3 6167U",7,), ("i3 6157U",7,), ("i3 6100H",7,), ("i3 6100U",7,), ("i3 6006U",7,), ("intel 6Y75",7,), ("intel 6Y57",7,), ("intel 6Y54",7,), ("intel 6Y30",7,), ("pentium 4405U",7,), ("pentium 4405Y",7,), ("celeron G3902E",7,), ("celeron G3900E",7,), ("celeron 3955U",7,), ("celeron 3855U",7,), ("xeon 2102",7,), ("xeon 2104",7,), ("xeon 2123",7,), ("xeon 2125",7,), ("xeon 2133",7,), ("xeon 2135",7,), ("xeon 2140B",7,), ("xeon 2145",7,), ("xeon 2150B",7,), ("xeon 2155",7,), ("xeon 2170B",7,), ("xeon 2175",7,), ("xeon 2191B",7,), ("xeon 2195",7,), ("xeon 1280v5",7,), ("xeon 1275v5",7,), ("xeon 1270v5",7,), ("xeon 1260Lv5",7,), ("xeon 1245v5",7,), ("xeon 1240v5",7,), ("xeon 1240Lv5",7,), ("xeon 1230v5",7,), ("xeon 1235Lv5",7,), ("xeon 1225v5",7,), ("xeon 1220v5",7,), ("xeon 1575Mv5",7,), ("xeon 1545Mv5",7,), ("xeon 1535Mv5",7,), ("xeon 1505Mv5",7,), ("xeon 1505Lv5",7,), ("xeon 3104",7,), ("xeon 3106",7,), ("xeon 4108",7,), ("xeon 4109T",7,), ("xeon 4110",7,), ("xeon 4112",7,), ("xeon 4114",7,), ("xeon 4114T",7,), ("xeon 4116",7,), ("xeon 4116T",7,), ("xeon 5115",7,), ("xeon 5117",7,), ("xeon 5117F",7,), ("xeon 5118",7,), ("xeon 5119T",7,), ("xeon 5120",7,), ("xeon 5120T",7,), ("xeon 5122",7,), ("xeon 6126",7,), ("xeon 6126F",7,), ("xeon 6126T",7,), ("xeon 6128",7,), ("xeon 6130",7,), ("xeon 6130F",7,), ("xeon 6130T",7,), ("xeon 6132",7,), ("xeon 6134",7,), ("xeon 6134M",7,), ("xeon 6136",7,), ("xeon 6138",7,), ("xeon 6138F",7,), ("xeon 6138T",7,), ("xeon 6140",7,), ("xeon 6140M",7,), ("xeon 6142",7,), ("xeon 6142F",7,), ("xeon 6142M",7,), ("xeon 6144",7,), ("xeon 6145",7,), ("xeon 6146",7,), ("xeon 6148",7,), ("xeon 6148F",7,), ("xeon 6149",7,), ("xeon 6150",7,), ("xeon 6152",7,), ("xeon 6154",7,), ("xeon 6161",7,), ("xeon 8153",7,), ("xeon 8156",7,), ("xeon 8158",7,), ("xeon 8160",7,), ("xeon 8160F",7,), ("xeon 8160M",7,), ("xeon 8160T",7,), ("xeon 8163",7,), ("xeon 8164",7,), ("xeon 8167M",7,), ("xeon 8168",7,), ("xeon 8170",7,), ("xeon 8170M",7,), ("xeon 8173M",7,), ("xeon 8176",7,), ("xeon 8176F",7,), ("xeon 8176M",7,), ("xeon 8180",7,), ("xeon 8180M",7,), ("i7 7740X",8,), ("i7 7700K",8,), ("i7 7700",8,), ("i7 7700T",8,), ("i5 7640X",8,), ("i5 7600K",8,), ("i5 7600",8,), ("i5 7600T",8,), ("i5 7500",8,), ("i5 7500T",8,), ("i5 7400",8,), ("i5 7400T",8,), ("i3 7350K",8,), ("i3 7320",8,), ("i3 7300",8,), ("i3 7300T",8,), ("i3 7100",8,), ("i3 7100T",8,), ("i3 7101E",8,), ("i3 7101TE",8,), ("pentium G4620",8,), ("pentium G4600",8,), ("pentium G4600T",8,), ("pentium G4560",8,), ("pentium G4560T",8,), ("celeron G3950",8,), ("celeron G3930",8,), ("celeron G3930T",8,), ("i7 7920HQ",8,), ("i7 7820HQ",8,), ("i7 7820HK",8,), ("i7 7700HQ",8,), ("i5 7440HQ",8,), ("i5 7300HQ",8,), ("i3 7100H",8,), ("i7 7660U",8,), ("i7 7600U",8,), ("i7 7567U",8,), ("i7 7560U",8,), ("i7 7500U",8,), ("i7 7Y75",8,), ("i5 7360U",8,), ("i5 7300U",8,), ("i5 7287U",8,), ("i5 7267U",8,), ("i5 7260U",8,), ("i5 7200U",8,), ("i5 7Y57",8,), ("i5 7Y54",8,), ("i3 7167U",8,), ("i3 7130U",8,), ("i3 7100U",8,), ("i3 7020U",8,), ("intel 7Y32",8,), ("intel 7Y30",8,), ("pentium 4415U",8,), ("pentium 4410Y",8,), ("celeron 3965U",8,), ("celeron 3865U",8,), ("celeron 3965Y",8,), ("xeon 1285v6",8,), ("xeon 1280v6",8,), ("xeon 1275v6",8,), ("xeon 1270v6",8,), ("xeon 1245v6",8,), ("xeon 1240v6",8,), ("xeon 1230v6",8,), ("xeon 1225v6",8,), ("xeon 1220v6",8,), ("xeon 1535Mv6",8,), ("xeon 1505Mv6",8,), ("xeon 1505Lv6",8,), ("i3 8130U",8,), ("i7 8650U",8,), ("i7 8550U",8,), ("i5 8350U",8,), ("i5 8250U",8,), ("i7 8809G",8,), ("i7 8709G",8,), ("i7 8706G",8,), ("i7 8705G",8,), ("i5 8305G",8,), ("i7 8510Y",8,), ("i7 8500Y",8,), ("i5 8310Y",8,), ("i5 8210Y",8,), ("i5 8200Y",8,), ("intel 8100Y",8,)]
res=[]
for idx, (keywords,gen_id,) in enumerate(intel_processors):
    time.sleep(3)
    print("searching for {} [{}/{}].".format(keywords, idx, len(intel_processors)))
    url=gen_url(keywords=keywords)
    r=requests.get(url)
    content=r.text.replace("&#8203", "")
    soup=BeautifulSoup(content, "html.parser")
    articles=soup.find_all("article", {("class"):("aditem")})
    if ( articles is None ):
        logging.info("No articles match {}.".format(keywords))
    # parse articles
    for article in articles:
        details=article.find("div", {("class"):("aditem-details")})
        price=((details) and (details.find("strong").text))
        vb=((price) and (("VB" in price)))
        header=article.find("h2", {("class"):("text-module-begin")})
        href=((header) and (header.find("a", href=True)["href"]))
        date=article.find("div", {("class"):("aditem-addon")}).text.strip()
        ignore=False
        timestamp=time.time()
        content=article
        search=keywords
        generation=gen_id
        res.append({("details"):(details),("price"):(price),("vb"):(vb),("header"):(header),("href"):(href),("date"):(date),("ignore"):(ignore),("timestamp"):(timestamp),("content"):(content),("search"):(search),("generation"):(generation)})
    df=pd.DataFrame(res)
    df.to_csv("output.csv")